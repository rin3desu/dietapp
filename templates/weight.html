{% extends 'layout.html' %}

{% block title %}体重記録 - Diet App{% endblock %}

{% block content %}
    <h1>体重記録</h1>

    <section>
        <h2>今日の体重を記録する</h2>
        <form action="{{ url_for('weight_page') }}" method="post">
            <label for="date">日付:</label>
            <input type="date" id="date" name="date" required>
            
            <label for="weight">体重 (kg):</label>
            <input type="number" step="0.1" id="weight" name="weight" required>
            
            <button type="submit">記録する</button>
        </form>
    </section>

    <hr>

    <section>
        <h2>体重推移グラフ</h2>
        <canvas id="weightChart" width="400" height="200"></canvas>
    </section>

    <hr>

    <section>
        <h2>体重履歴</h2>
        <table border="1" style="width:100%;">
            <thead>
                <tr>
                    <th>記録日時</th>
                    <th>体重 (kg)</th>
                </tr>
            </thead>
            <tbody>
                {% for record in records %}
                <tr>
                    <td>{{ record['date'] }}</td>
                    <td>{{ record['weight'] }}</td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="2">まだ体重の記録がありません。</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </section>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
        // Flaskから渡されたデータをJavaScriptの変数に変換
        const labels = {{ dates | tojson }};
        const data = {{ weights | tojson }};

        const ctx = document.getElementById('weightChart').getContext('2d');
        const weightChart = new Chart(ctx, {
            type: 'line', // 折れ線グラフ
            data: {
                labels: labels,
                datasets: [{
                    label: '体重 (kg)',
                    data: data,
                    borderColor: 'rgb(75, 192, 192)',
                    tension: 0.1
                }]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: false // Y軸の開始を0にしない
                    }
                }
            }
        });
    </script>
{% endblock %}